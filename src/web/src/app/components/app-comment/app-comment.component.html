<div class="comment">
  <ng-container *ngIf="!isLoggedIn;else $editComment">
    <div class="title">
      <span i18n>Please post a comment after signed in</span>
      <a href
         i18n>Sign Up</a>
    </div>
    <button class="loginBtn"
            (click)="login()"
            i18n>Sign In</button>
  </ng-container>
  <ng-template #$editComment>
    <ng-container *ngIf="own$|async as $own;else $edit">
      <div class="title">
        <span class="star">
          <div i18n>Please rate</div>
          <dstore-star [rate]="$own.rate"></dstore-star>
          <div>{{$own.rate}}</div>
        </span>
      </div>
      <div class="placeholder"
           i18n>You have posted a comment</div>
    </ng-container>
    <ng-template #$edit>
      <div class="title">
        <span class="star">
          <div i18n>Please rate</div>
          <dstore-star [(rate)]="rate"
                       #$star
                       [readonly]="false"></dstore-star>
          <div>{{$star.rateHover||$star.rate}}</div>
        </span>
      </div>
      <textarea class="input"
                [(ngModel)]="content"></textarea>
      <div class="placeholder"
           [hidden]="content"
           i18n>Please input a comment</div>
    </ng-template>
  </ng-template>
</div>

<div class="submit"
     *ngIf="isLoggedIn">
  <ng-container [ngSwitch]="submitError">
    <span class="submitError"
          *ngSwitchCase="CommentError.AllInvalid"
          i18n>Please rate and input your comment</span>
    <span class="submitError"
          *ngSwitchCase="CommentError.CommentInvalid"
          i18n>Please input your comment</span>
    <span class="submitError"
          *ngSwitchCase="CommentError.RateInvalid"
          i18n>Please rate</span>
    <span class="submitError"
          *ngSwitchCase="CommentError.Failed"
          i18n>Failed to submit</span>
  </ng-container>
  <button class="submitBtn"
          (click)="submitComment()"
          [disabled]="own$|async"
          #$submitBtn
          i18n>Submit</button>
</div>
<br>
<ng-container *ngIf="currentList|chunk:5 as $css">
  <div class="paging">
    <div class="title"
         i18n>User Comments</div>
    <div class="versionBtn currentBtn"
         (click)="select='current'"
         [class.active]="select==='current'"
         i18n>Current Version ({{commentList?.length}})</div>
    <div class="versionBtn historyBtn"
         (click)="select='history'"
         [class.active]="select==='history'"
         i18n>History Versions ({{historyList?.length}})</div>
    <div class="pagingBtn"
         [hidden]="$css.length<=1">
      <app-paginator [count]="$css.length"
                     #$paginator></app-paginator>
    </div>
  </div>
  <br>
  <div class="commentList">
    <ng-container *ngIf="$css.length===0">
      <div class="commentItem empty error"
           *ngIf="getListError;else $empty"
           i18n>Failed to load comments</div>
      <ng-template #$empty>
        <div class="commentItem empty"
             i18n>There are not any user comments</div>
      </ng-template>
    </ng-container>
    <div class="commentItem"
         *ngFor="let c of $css[$paginator.pageIndex]">
      <ng-container *ngIf="getUserInfo(c.userID)|async as $userInfo">
        <div class="head">
          <img [src]="$userInfo.profile_image"
               class="icon">
          <span>{{$userInfo.username}}</span>
        </div>
        <div class="body">
          <div class="rate">
            <dstore-star [rate]="c.rate"></dstore-star>
            <span>{{c.rate}}</span>
            <img class="hot"
                 *ngIf="c.hot">
          </div>
          <span>{{c.content}}</span>
        </div>
        <div class="time">{{c.createTime}}</div>
        <div class="like">
          <span *ngIf="c.likeCount">({{c.likeCount}})</span>
          <img class="thumbUp"
               [class.active]="c.likeByMe"
               (click)="thumbUpClick(c)"
               *ngIf="$userInfo.username!=name">
        </div>
      </ng-container>
    </div>
  </div>
</ng-container>